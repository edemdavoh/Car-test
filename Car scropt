--[[ 
    Complete Roblox Car Script
    Spawns the car asset, tunes speed & suspension, and adds camera shake.
    Place this LocalScript in StarterPlayerScripts.
--]]

local player      = game.Players.LocalPlayer
local RunService  = game:GetService("RunService")
local InsertService = game:GetService("InsertService")
local workspace   = game.Workspace
local cam         = workspace.CurrentCamera

-- SETTINGS
local ASSET_ID          = 15834447839     -- Car asset ID
local MAX_SPEED         = 80              -- “pretty fast but not too fast”
local TORQUE            = 5000
local TURN_SPEED        = 3
local SPRING_STIFFNESS  = 2000
local SPRING_DAMPING    = 250
local SHAKE_MAGNITUDE   = 0.3
local SHAKE_FREQUENCY   = 5

-- Insert the car into the world if it’s not already there
local car = InsertService:LoadAsset(ASSET_ID)
car.Parent = workspace
car.Name   = "SpawnedCar"

-- Grab the VehicleSeat and tune performance
local seat = car:WaitForChild("VehicleSeat")
seat.MaxSpeed = MAX_SPEED
seat.Torque   = TORQUE
seat.TurnSpeed= TURN_SPEED

-- Optional: adjust any SpringConstraints for suspension feel
for _, spring in ipairs(car:GetDescendants()) do
	if spring:IsA("SpringConstraint") then
		spring.Stiffness = SPRING_STIFFNESS
		spring.Damping   = SPRING_DAMPING
	end
end

-- Track when the player sits in this specific car
local vehicleSeat
player.CharacterAdded:Connect(function(char)
	char:WaitForChild("Humanoid").Seated:Connect(function(active, seatObj)
		if active and seatObj:IsA("VehicleSeat") and seatObj:IsDescendantOf(car) then
			vehicleSeat = seatObj
		else
			vehicleSeat = nil
		end
	end)
end)

-- Camera shake loop
RunService.RenderStepped:Connect(function()
	if vehicleSeat and vehicleSeat.Velocity.Magnitude > 5 then
		local yVel = math.abs(vehicleSeat.Velocity.Y)
		if yVel > 2 then
			local offset = Vector3.new(
				math.sin(tick() * SHAKE_FREQUENCY) * SHAKE_MAGNITUDE,
				math.cos(tick() * SHAKE_FREQUENCY * 1.2) * SHAKE_MAGNITUDE,
				0
		 )
			cam.CFrame = cam.CFrame * CFrame.new(offset)
		end
	end
end)
